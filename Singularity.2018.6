Bootstrap: docker
From: ubuntu:16.04

%labels
Maintainer Matthew Flister
Version 2018.6

%help
This container runs QIIME 2.

%environment
    source activate qiime2-2018.6

%runscript
    exec qiime "${@}"

%post
    # default mount points
    mkdir -p /scratch/global /scratch/local /rcc/stor1/refdata /rcc/stor1/projects /rcc/stor1/depts
    
    # Install necessary packages
    apt-get update && apt-get install -y --no-install-recommends \
        build-essential \
        gcc-multilib \
        python3-dev \
        python3-setuptools \
        wget
    apt-get clean

    # Install miniconda
    wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
    bash Miniconda3-latest-Linux-x86_64.sh
    conda update -y conda
    rm -rf Miniconda3-latest-Linux-x86_64.sh
    
    # Install QIIME 2
    wget https://data.qiime2.org/distro/core/qiime2-2018.6-py35-linux-conda.yml
    conda env create -n qiime2-2018.6 --file qiime2-2018.6-py35-linux-conda.yml
    rm -rf qiime2-2018.6-py35-linux-conda.yml

